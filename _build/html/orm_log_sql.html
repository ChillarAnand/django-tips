

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Log SQL Queries To Console &mdash; django-tips  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> django-tips
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="admin_auto_register_models.html">Automatically Register All Models In Admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="admin_hyperlink_foreignkey.html">Hyperlink Foreignkey Fields To Its Change View In Admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="admin_custom_admin_actions.html">Custom admin actions for individual and bulk objects</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">django-tips</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Log SQL Queries To Console</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/orm_log_sql.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="log-sql-queries-to-console">
<h1>Log SQL Queries To Console<a class="headerlink" href="#log-sql-queries-to-console" title="Permalink to this headline">¶</a></h1>
<p>Django ORM makes easy to interact with database. To understand what is happening behing the scenes or to see SQL performance, we can log all the SQL queries that be being executed. In this article, we will see various ways to achieve this.</p>
<p>Using debug-toolbar
Django debug toolbar provides panels to show debug information about requests. It has SQL panel which shows all executed SQL queries and time taken for them.</p>
<p>When building REST APIs or micro services where django templating engine is not used, this method won’t work. In these situations, we have to log SQL queries to console.</p>
<p>Using django-extensions
Django-extensions provides lot of utilities for productive development. For runserver_plus and shell_plus commands, it accepts and optional –print-sql argument, which prints all the SQL queries that are being executed.</p>
<p>./manage.py runserver_plus –print-sql
./manage.py shell_plus –print-sql
Whenever an SQL query gets executed, it prints the query and time taken for it in console.</p>
<p>In [42]: User.objects.filter(is_staff=True)
Out[42]: SELECT “auth_user”.”id”,</p>
<blockquote>
<div><blockquote>
<div><blockquote>
<div>“auth_user”.”password”,
“auth_user”.”last_login”,
“auth_user”.”is_superuser”,
“auth_user”.”username”,
“auth_user”.”first_name”,
“auth_user”.”last_name”,
“auth_user”.”email”,
“auth_user”.”is_staff”,
“auth_user”.”is_active”,
“auth_user”.”date_joined”</div></blockquote>
<p>FROM “auth_user”</p>
</div></blockquote>
<p>WHERE “auth_user”.”is_staff” = true
LIMIT 21</p>
</div></blockquote>
<p>Execution time: 0.002107s [Database: default]</p>
<p>&lt;QuerySet [&lt;User: anand&gt;, &lt;User: chillar&gt;]&gt;
Using django-querycount
Django-querycount provides a middleware to show SQL query count and show duplicate queries on console.</p>
<p><a href="#id1"><span class="problematic" id="id2">|------|</span></a>———–<a href="#id3"><span class="problematic" id="id4">|----------|</span></a>———-<a href="#id5"><span class="problematic" id="id6">|----------|</span></a>————|
| Type | Database  |   Reads  |  Writes  |  Totals  | Duplicates |
<a href="#id7"><span class="problematic" id="id8">|------|</span></a>———–<a href="#id9"><span class="problematic" id="id10">|----------|</span></a>———-<a href="#id11"><span class="problematic" id="id12">|----------|</span></a>————|
| RESP |  default  |    3     |    0     |    3     |     1      |
<a href="#id13"><span class="problematic" id="id14">|------|</span></a>———–<a href="#id15"><span class="problematic" id="id16">|----------|</span></a>———-<a href="#id17"><span class="problematic" id="id18">|----------|</span></a>————|
Total queries: 3 in 1.7738s</p>
<p>Repeated 1 times.
SELECT “django_session”.”session_key”,
“django_session”.”session_data”, “django_session”.”expire_date” FROM
“django_session” WHERE (“django_session”.”session_key” =
‘dummy_key AND “django_session”.”expire_date”
&gt; ‘2018-05-31T09:38:56.369469+00:00’::timestamptz)
This package provides additional settings to customize output.</p>
<p>Django logging
Instead of using any 3rd party package, we can use django.db.backends logger to print all the SQL queries.</p>
<p>Add django.db.backends to loggers list and set log level and handlers.</p>
<blockquote>
<div><dl class="docutils">
<dt>‘loggers’: {</dt>
<dd><dl class="first docutils">
<dt>‘django.db.backends’: {</dt>
<dd>‘level’: ‘DEBUG’,
‘handlers’: [‘console’, ],</dd>
</dl>
<p class="last">},</p>
</dd>
</dl>
</div></blockquote>
<p>In runserver console, we can see all SQL queries that are being executed.</p>
<p>(0.001) SELECT “django_admin_log”.”id”, “django_admin_log”.”action_time”, “django_admin_log”.”user_id”, “django_admin_log”.”content_type_id”, “django_admin_log”.”object_id”, “django_admin_log”.”object_repr”, “django_admin_log”.”action_flag”, “django_admin_log”.”change_message”, “auth_user”.”id”, “auth_user”.”password”, “auth_user”.”last_login”, “auth_user”.”is_superuser”, “auth_user”.”username”, “auth_user”.”first_name”, “auth_user”.”last_name”, “auth_user”.”email”, “auth_user”.”is_staff”, “auth_user”.”is_active”, “auth_user”.”date_joined”, “django_content_type”.”id”, “django_content_type”.”app_label”, “django_content_type”.”model” FROM “django_admin_log” INNER JOIN “auth_user” ON (“django_admin_log”.”user_id” = “auth_user”.”id”) LEFT OUTER JOIN “django_content_type” ON (“django_admin_log”.”content_type_id” = “django_content_type”.”id”) WHERE “django_admin_log”.”user_id” = 4 ORDER BY “django_admin_log”.”action_time” DESC LIMIT 10; args=(4,)
[2018/06/03 15:06:59] HTTP GET /admin/ 200 [1.69, 127.0.0.1:47734]
These are few ways to log all SQL queries to console. We can also write a custom middleware for better logging of these queries and get some insights.</p>
<p>django django-tips-tricks python
Previous post Next post</p>
<blockquote>
<div>Written by</div></blockquote>
<p>Chillar Anand
Musings about programming, careers &amp; life.
Comments</p>
<p>Contents © 2019 Chillar Anand - Powered by Nikola</p>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ChillarAnand

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>